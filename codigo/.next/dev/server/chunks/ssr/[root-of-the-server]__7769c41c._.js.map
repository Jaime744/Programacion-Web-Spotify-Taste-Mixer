{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///mnt/c/Github/Programacion-Web-Spotify-Taste-Mixer/spotify/src/lib/auth.js"],"sourcesContent":["async function spotifyRequest(url) {\r\n  const token = getAccessToken();\r\n  \r\n  if (!token) {\r\n    // Intentar refrescar token\r\n    const newToken = await refreshAccessToken();\r\n    if (!newToken) {\r\n      // Redirigir a login\r\n      window.location.href = '/';\r\n      return;\r\n    }\r\n  }\r\n\r\n  const response = await fetch(url, {\r\n    headers: { 'Authorization': `Bearer ${token}` }\r\n  });\r\n\r\n  if (response.status === 401) {\r\n    // Token expirado, refrescar\r\n    const newToken = await refreshAccessToken();\r\n    // Reintentar petici贸n\r\n  }\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Error ${response.status}: ${response.statusText}`);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// Generar string aleatorio para el par谩metro 'state'\r\nexport function generateRandomString(length) {\r\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  let text = '';\r\n  for (let i = 0; i < length; i++) {\r\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\r\n  }\r\n  return text;\r\n}\r\n\r\n// Construir URL de autorizaci贸n de Spotify\r\nexport function getSpotifyAuthUrl() {\r\n  const clientId = process.env.NEXT_PUBLIC_SPOTIFY_CLIENT_ID || '';\r\n  const redirectUri = process.env.NEXT_PUBLIC_REDIRECT_URI || '';\r\n  const state = generateRandomString(16);\r\n\r\n  // Guardar el state para validaci贸n posterior \r\n  if (typeof window !== 'undefined') {  \r\n    localStorage.setItem('spotify_auth_state', state);  \r\n  }\r\n\r\n  const scope = [\r\n    'user-read-private',\r\n    'user-read-email',\r\n    'user-top-read',\r\n    'playlist-modify-public',\r\n    'playlist-modify-private'\r\n  ].join(' ');\r\n\r\n  const params = new URLSearchParams({\r\n    client_id: clientId,\r\n    response_type: 'code',\r\n    redirect_uri: redirectUri,\r\n    state: state,\r\n    scope: scope\r\n  });\r\n\r\n  return `https://accounts.spotify.com/authorize?${params.toString()}`;\r\n}\r\n\r\n// Guardar tokens en localStorage\r\nexport function saveTokens(accessToken, refreshToken, expiresIn) {\r\n  const expirationTime = Date.now() + expiresIn * 1000;\r\n  if (typeof window !== 'undefined') {  \r\n    localStorage.setItem('spotify_token', accessToken);\r\n    localStorage.setItem('spotify_refresh_token', refreshToken);\r\n    localStorage.setItem('spotify_token_expiration', expirationTime.toString());\r\n  }\r\n}\r\n\r\n// Obtener token actual (con verificaci贸n de expiraci贸n)\r\nexport function getAccessToken() {\r\n  \r\n  if (typeof window === \"undefined\") {\r\n    return null;  \r\n  }\r\n\r\n  const token = localStorage.getItem('spotify_token');\r\n  const expiration = localStorage.getItem('spotify_token_expiration');\r\n  \r\n  if (!token || !expiration) return null;\r\n\r\n  // Si el token expiro, retorno null\r\n  if (Date.now() > parseInt(expiration)) {\r\n    return null;\r\n  }\r\n\r\n  return token;\r\n}\r\n\r\n// Verificar si hay token v谩lido\r\nexport function isAuthenticated() {\r\n  return getAccessToken() !== null;\r\n}\r\n\r\n// Cerrar sesi贸n\r\nexport function logout() {\r\n  if (typeof window !== 'undefined') {  // Solo ejecutamos esto en el cliente\r\n    localStorage.removeItem('spotify_token');\r\n    localStorage.removeItem('spotify_refresh_token');\r\n    localStorage.removeItem('spotify_token_expiration');\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,eAAe,eAAe,GAAG;IAC/B,MAAM,QAAQ;IAEd,IAAI,CAAC,OAAO;QACV,2BAA2B;QAC3B,MAAM,WAAW,MAAM;QACvB,IAAI,CAAC,UAAU;YACb,oBAAoB;YACpB,OAAO,QAAQ,CAAC,IAAI,GAAG;YACvB;QACF;IACF;IAEA,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,SAAS;YAAE,iBAAiB,CAAC,OAAO,EAAE,OAAO;QAAC;IAChD;IAEA,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3B,4BAA4B;QAC5B,MAAM,WAAW,MAAM;IACvB,sBAAsB;IACxB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,SAAS,MAAM,CAAC,EAAE,EAAE,SAAS,UAAU,EAAE;IACpE;IAEA,OAAO,SAAS,IAAI;AACtB;AAGO,SAAS,qBAAqB,MAAM;IACzC,MAAM,WAAW;IACjB,IAAI,OAAO;IACX,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,QAAQ,SAAS,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,SAAS,MAAM;IACpE;IACA,OAAO;AACT;AAGO,SAAS;IACd,MAAM,WAAW,wEAA6C;IAC9D,MAAM,cAAc,2EAAwC;IAC5D,MAAM,QAAQ,qBAAqB;IAEnC,8CAA8C;IAC9C;;IAIA,MAAM,QAAQ;QACZ;QACA;QACA;QACA;QACA;KACD,CAAC,IAAI,CAAC;IAEP,MAAM,SAAS,IAAI,gBAAgB;QACjC,WAAW;QACX,eAAe;QACf,cAAc;QACd,OAAO;QACP,OAAO;IACT;IAEA,OAAO,CAAC,uCAAuC,EAAE,OAAO,QAAQ,IAAI;AACtE;AAGO,SAAS,WAAW,WAAW,EAAE,YAAY,EAAE,SAAS;IAC7D,MAAM,iBAAiB,KAAK,GAAG,KAAK,YAAY;IAChD;;AAKF;AAGO,SAAS;IAEd,wCAAmC;QACjC,OAAO;IACT;;;IAEA,MAAM;IACN,MAAM;AAUR;AAGO,SAAS;IACd,OAAO,qBAAqB;AAC9B;AAGO,SAAS;IACd;;AAKF","debugId":null}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///mnt/c/Github/Programacion-Web-Spotify-Taste-Mixer/spotify/src/components/widgets/ArtistWidget.jsx"],"sourcesContent":["'use client'; \nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\n// funci贸n que coge de la api los artistas mas escuchados y te lo muestra\nexport default function ArtistWidget({ accessToken }) {\n  const [artists, setArtists] = useState([]);\n  const [isClient, setIsClient] = useState(false);\n\n  useEffect(() => {\n    setIsClient(true);  \n  }, []);\n\n  useEffect(() => {\n    if (accessToken && isClient) {\n      const fetchArtists = async () => {\n        try {\n          const response = await axios.get(\"https://api.spotify.com/v1/me/top/artists\", {\n            headers: {\n              Authorization: `Bearer ${accessToken}`,\n            },\n          });\n          setArtists(response.data.items);\n        } catch (error) {\n          console.error(\"Error fetching artists:\", error);\n        }\n      };\n      fetchArtists();\n    }\n  }, [accessToken, isClient]);\n\n  if (!isClient) {\n    return null;\n  }\n\n  return (\n    <div className=\"widget\">\n      <ul>\n        <h2>Tus artistas favoritos</h2>\n        {artists.length > 0 ? (\n          artists.map((artist) => (\n            <li key={artist.id}>\n              <img src={artist.images[0]?.url} alt={artist.name} width={50} />\n              <span>{artist.name}</span>\n            </li>\n          ))\n        ) : (\n          <p>Loading artists...</p>\n        )}\n      </ul>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAFA;;;;AAIe,SAAS,aAAa,EAAE,WAAW,EAAE;IAClD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC,EAAE;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IAEzC,IAAA,kNAAS,EAAC;QACR,YAAY;IACd,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,eAAe,UAAU;YAC3B,MAAM,eAAe;gBACnB,IAAI;oBACF,MAAM,WAAW,MAAM,gJAAK,CAAC,GAAG,CAAC,6CAA6C;wBAC5E,SAAS;4BACP,eAAe,CAAC,OAAO,EAAE,aAAa;wBACxC;oBACF;oBACA,WAAW,SAAS,IAAI,CAAC,KAAK;gBAChC,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,2BAA2B;gBAC3C;YACF;YACA;QACF;IACF,GAAG;QAAC;QAAa;KAAS;IAE1B,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;;8BACC,8OAAC;8BAAG;;;;;;gBACH,QAAQ,MAAM,GAAG,IAChB,QAAQ,GAAG,CAAC,CAAC,uBACX,8OAAC;;0CACC,8OAAC;gCAAI,KAAK,OAAO,MAAM,CAAC,EAAE,EAAE;gCAAK,KAAK,OAAO,IAAI;gCAAE,OAAO;;;;;;0CAC1D,8OAAC;0CAAM,OAAO,IAAI;;;;;;;uBAFX,OAAO,EAAE;;;;8CAMpB,8OAAC;8BAAE;;;;;;;;;;;;;;;;;AAKb","debugId":null}},
    {"offset": {"line": 305, "column": 0}, "map": {"version":3,"sources":["file:///mnt/c/Github/Programacion-Web-Spotify-Taste-Mixer/spotify/src/app/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { isAuthenticated, getSpotifyAuthUrl } from '@/lib/auth';\r\nimport ArtistWidget from '../components/widgets/ArtistWidget';\r\n\r\nexport default function Home() {\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    // Si ya est谩 autenticado, redirigir al dashboard\r\n    if (isAuthenticated()) {\r\n      router.push('/dashboard');\r\n    }\r\n  }, [router]);\r\n\r\n  const handleLogin = () => {\r\n    // Redirige a la URL de autenticaci贸n de Spotify\r\n    window.location.href = getSpotifyAuthUrl();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <h1> Spotify Taste Mixer</h1>\r\n      {!isAuthenticated() ? (\r\n        <button onClick={handleLogin}>Login with Spotify</button>  \r\n      ) : (\r\n        <ArtistWidget />  \r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IAExB,IAAA,kNAAS,EAAC;QACR,iDAAiD;QACjD,IAAI,IAAA,qIAAe,KAAI;YACrB,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;KAAO;IAEX,MAAM,cAAc;QAClB,gDAAgD;QAChD,OAAO,QAAQ,CAAC,IAAI,GAAG,IAAA,uIAAiB;IAC1C;IAEA,qBACE;;0BACE,8OAAC;0BAAG;;;;;;YACH,CAAC,IAAA,qIAAe,oBACf,8OAAC;gBAAO,SAAS;0BAAa;;;;;qCAE9B,8OAAC,wJAAY;;;;;;;AAIrB","debugId":null}}]
}